<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>第5.9节 LDAP注入</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="methodology.html">methodology</a></p>

<ol>
<li><a href="methodology--第一部分_信息收集.html">第一部分 信息收集</a></li>
<ol>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集.html">第1章 端口信息收集</a></li>
<ol>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.1节_21端口ftp.html">第1.1节 21端口ftp</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.2节_22端口ssh.html">第1.2节 22端口ssh</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.3节_25端口SMTP.html">第1.3节 25端口SMTP</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.4节_53端口DNS.html">第1.4节 53端口DNS</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.5节_79端口Finger.html">第1.5节 79端口Finger</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.6节_161端口snmp.html">第1.6节 161端口snmp</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.7节_137-139-445_smb.html">第1.7节 137/139/445 smb</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.8节_389端口ldap.html">第1.8节 389端口ldap</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.9节_2049端口nfs.html">第1.9节 2049端口nfs</a></li>
</ol>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集.html">第2章 web信息收集</a></li>
<ol>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.1节_枚举web目录.html">第2.1节 枚举web目录</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.2节_http方法测试.html">第2.2节 http方法测试</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.3节_https方法测试.html">第2.3节 https方法测试</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.4节_web页面生成字典.html">第2.4节 web页面生成字典</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.5节_web页面图片泄露.html">第2.5节 web页面图片泄露</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.6节_Squid代理.html">第2.6节 Squid代理</a></li>
</ol>
</ol>
<li><a href="methodology--第二部分_漏洞利用.html">第二部分 漏洞利用</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第3章_未知exp的漏洞.html">第3章 未知exp的漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第3章_未知exp的漏洞--第3.1节_搜索exp.html">第3.1节 搜索exp</a></li>
<li><a href="methodology--第二部分_漏洞利用--第3章_未知exp的漏洞--第3.2节_下载exp.html">第3.2节 下载exp</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助.html">第4章 漏洞利用辅助</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.1节_文件字符串分析.html">第4.1节 文件字符串分析</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.2节_webshell.html">第4.2节 webshell</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.3节_反弹shell.html">第4.3节 反弹shell</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.4节_突破受限制的shell.html">第4.4节 突破受限制的shell</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.5节_传输文件.html">第4.5节 传输文件</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.6节_错误处理.html">第4.6节 错误处理</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞.html">第5章 通用漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.1节_登录凭证.html">第5.1节 登录凭证</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.2节_http_PUT方法.html">第5.2节 http PUT方法</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.3节_Shellshock.html">第5.3节 Shellshock</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.4节_任意文件读取LFI.html">第5.4节 任意文件读取LFI</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.5节_远程命令执行.html">第5.5节 远程命令执行</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.6节_sql注入漏洞.html">第5.6节 sql注入漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.6节_sql注入漏洞--mysql注入.html">mysql注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.6节_sql注入漏洞--mssql注入.html">mssql注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.6节_sql注入漏洞--oracle注入.html">oracle注入</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.7节_上传漏洞.html">第5.7节 上传漏洞</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.8节_Nosql注入.html">第5.8节 Nosql注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.9节_LDAP注入.html">第5.9节 LDAP注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.10节_服务端模板注入.html">第5.10节 服务端模板注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.11节_xxe漏洞.html">第5.11节 xxe漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.11节_xxe漏洞--案例1_excel的xxe.html">案例1: excel的xxe</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.11节_xxe漏洞--案例2_php的xxe执行命令.html">案例2 php的xxe执行命令</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.12节_xpath注入.html">第5.12节 xpath注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.13节_SSRF.html">第5.13节 SSRF</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.14节_Padding_Oracle_Attack.html">第5.14节 Padding Oracle Attack</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞.html">第6章 已知漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.1节_nodejs.html">第6.1节 nodejs</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php.html">第6.2节 php</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php--弱类型.html">弱类型</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php--php一句话.html">php一句话</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php--php代码注入.html">php代码注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php--php代码审计.html">php代码审计</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.3节_java.html">第6.3节 java</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.3节_java--处理excel导致的xxe漏洞.html">处理excel导致的xxe漏洞</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.3节_java--java反序列化demo.html">java反序列化demo</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.3节_java--Apache_Shiro_rememberMe反序列化.html">Apache Shiro rememberMe反序列化</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.4节_thinkphp.html">第6.4节 thinkphp</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.4节_thinkphp--thinkphp5.0.235.1.31.html">thinkphp<5.0.23<5.1.31</a></li>
</ol>
</ol>
</ol>
<li><a href="methodology--第三部分_权限提升.html">第三部分 权限提升</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权.html">第7章 linux提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.1节_寻找登录凭证.html">第7.1节 寻找登录凭证</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.2节_寻找可写文件.html">第7.2节 寻找可写文件</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.3节_内核提权.html">第7.3节 内核提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.3节_内核提权--案例1_dirtyc0w提权.html">案例1 dirtyc0w提权</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.3节_内核提权--案例2_ubuntu提权.html">案例2 ubuntu提权</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权.html">第7.4节 进程提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权--4.3.1_mysql.html">4.3.1 mysql</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权--4.3.2_nfs提权.html">4.3.2 nfs提权</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权--4.3.3_chkrootkit提权.html">4.3.3 chkrootkit提权</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权--4.3.4_tar通配符提权.html">4.3.4 tar通配符提权</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.5节_定时任务.html">第7.5节 定时任务</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.6节_sudo提权.html">第7.6节 sudo提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.6节_sudo提权--4.5.1_nmap.html">4.5.1 nmap</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.7节_SUID文件.html">第7.7节 SUID文件</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.8节_root.html">第7.8节 root</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.8节_root--4.7.1_执行命令.html">4.7.1 执行命令</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.8节_root--4.7.2_编辑文件.html">4.7.2 编辑文件</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.9节_劫持全路径.html">第7.9节 劫持全路径</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.10_环境变量.html">第7.10 环境变量</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.11节_破解shadow文件.html">第7.11节 破解shadow文件</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第8章_windows提权.html">第8章 windows提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第8章_windows提权--windows提权辅助.html">windows提权辅助</a></li>
</ol>
</ol>
<li><a href="methodology--第四部分_内网漫游.html">第四部分 内网漫游</a></li>
<ol>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot.html">第9章 Pivot</a></li>
<ol>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot--第9.1节_ssh端口转发.html">第9.1节 ssh端口转发</a></li>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot--第9.2节_iptables端口转发.html">第9.2节 iptables端口转发</a></li>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot--第9.3节_msf后渗透.html">第9.3节 msf后渗透</a></li>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot--第9.0节_未整理.html">第9.0节 未整理</a></li>
</ol>
<li><a href="methodology--第四部分_内网漫游--第10章_缓冲区溢出.html">第10章 缓冲区溢出</a></li>
<ol>
<li><a href="methodology--第四部分_内网漫游--第10章_缓冲区溢出--第10.1节_windows溢出.html">第10.1节 windows溢出</a></li>
<ol>
<li><a href="methodology--第四部分_内网漫游--第10章_缓冲区溢出--第10.1节_windows溢出--brainpan.html">brainpan</a></li>
<li><a href="methodology--第四部分_内网漫游--第10章_缓冲区溢出--第10.1节_windows溢出--smail案例.html">smail案例</a></li>
</ol>
</ol>
<li><a href="methodology--第四部分_内网漫游--metasploit.html">metasploit</a></li>
<li><a href="methodology--第四部分_内网漫游--backdoor.html">backdoor</a></li>
</ol>
<li><a href="methodology--第五部分_挖掘src.html">第五部分 挖掘src</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试.html">10. 业务逻辑测试</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论.html">10.1 业务逻辑理论</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.1_业务逻辑数据一致性.html">6.1.1 业务逻辑数据一致性</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.2_业务逻辑数据完整性.html">6.1.2 业务逻辑数据完整性</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.3_工作流程逃逸测试.html">6.1.3 工作流程逃逸测试</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.4_伪造请求能力测试.html">6.1.4 伪造请求能力测试</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.5_测试处理用时.html">6.1.5 测试处理用时</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--10.1.6_客户端认证.html">10.1.6 客户端认证</a></li>
</ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法.html">10.2 攻击方法</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法--6.2.1.1_加密http请求参数.html">6.2.1.1 加密http请求参数</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法--6.2.1.2_修改返回包.html">6.2.1.2 修改返回包</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法--6.2.1.3_修改http参数.html">6.2.1.3 修改http参数</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法--6.2.1.4_去除http请求参数.html">6.2.1.4 去除http请求参数</a></li>
</ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景.html">10.3 业务场景</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.1_用户操作.html">10.3.1 用户操作</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.2_用户注册.html">10.3.2 用户注册</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.3_修改密码.html">10.3.3 修改密码</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.4_验证码安全.html">10.3.4 验证码安全</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.5_订单安全.html">10.3.5 订单安全</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.6_功能使用次数.html">10.3.6 功能使用次数</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.7_客户端验证密码.html">10.3.7 客户端验证密码</a></li>
</ol>
</ol>
<li><a href="methodology--第五部分_挖掘src--11._app安全.html">11. app安全</a></li>
</ol>
<li><a href="methodology--oob.html">oob</a></li>
<li><a href="methodology--DDOS.html">DDOS</a></li>
<ol>
<li><a href="methodology--DDOS--DDOS事件处理.html">DDOS事件处理</a></li>
</ol></ol></div>
<div class="page"><h1><b><u>第5.9节 LDAP注入</u></b></h1># LDAP基础<br />LDAP查询使用一个或者多个过滤器。<br /><br /><br />1、简单匹配条件:<br />通过用户名搜索用户的应用程序<br />(username=daf)<br /><br /><br />2、析取查询，指定多个条件，返回的目录必须满足其中一个条件。<br />在多个目录属性中查找用户提供的搜索项<br />(|(cn=searchterm)(sn=searchterm)(ou=searchterm))<br /><br /><br />3、合取查询指定多个条件，返回的目录项必须满足所有这些条件。<br />比如登录机制:<br />(&amp;(username=daf)(password=secret))<br /><br /><br /># 利用LDAP注入<br />搜索过滤器的结构，用户输入的进入点有关。<br /><br /><br />1、析取查询<br />(|(department=London 输入)(department=Reading 输入))<br />只可以授权查看London和Reading两个地区的数据。<br />利用:<br />)(department=*<br />此时，过滤器变成如下:<br />```<br />(|(department=London)(department=*)(department=Reading)(department=*))<br />```<br />由于满足一项就可以，*是通配符，所以它会返回所以地区资料。<br /><br /><br />2、合取查询<br />允许按姓名在授权地理区域进行搜索雇员。<br />(&amp;(givenName=daf)(department=London*))<br />允许在伦敦通过姓名进行查询。<br /><br /><br />在此种情况下，攻击者可以实施两种攻击。<br />第一种:一些LDAP(OpenLDAP)允许批量使用多个搜索过滤器，并且选择性的应用这些过滤器。(应用程序返回与任意过滤器匹配的目录项，变为或了)<br />攻击者输入:<br />*))(&amp;(givenName=daf<br />得到的查询如下:<br />(&amp;(givenName=*))(&amp;(givenName=daf)(department=London*))<br />此时有两个过滤器,当满足一个就行，此时返回所有雇员资料。<br /><br /><br />两个过滤器满足一个就行，当第一个为空时，第二个或就非常重要呀。 <br />*))(|(ou=*<br /><br /><br />第二种:<br />利用LDAP服务在处理NULL字节方面存在漏洞。这些服务通常以本地代码编写，因此，搜索过滤器中的NULL字节将立即终止字符串。NULL之后的任何字符将被忽略。<br />此时攻击者可以提交以下输入:<br />*))%00 后面的被注释掉了<br />此时嵌入到搜索过滤器中的查询将变为:<br />(&amp;(givenName=*))[NULL])(department=London*))<br />此时，NULL后面被截断，因此返回所有雇员信息。<br /><br /><br /># 查找LDAP注入漏洞 <br />通常，向LDAP操作提交无效的输入并不会生成任何详细的错误信息。<br />（1）尝试输入*字符作为搜索项。如果返回大量结果，这种情况明显表示针对的是一个LDAP查询<br />(2)尝试输入大量的闭合号<br />)))))))<br />这个输入将结束仍会扩住输入，以及那些包含主查询过滤器的括号，导致无法匹配闭合号，因此破坏查询，如果发生错误，则应用程序可能是LDAP<br />(3)尝试输入各种意在干扰不同类型的查询的表达式，并看是否可以通过这个表达式来影响返回结果。LDAP都支持cn属性。<br />)(cn=*<br />*))(|(cn=*<br />*))%00<br /><br /><br /># 案例<br />http://web.chal.csaw.io:8080<br />合取查询，生成一个或过滤器<br />*))(|(ou=* <br />两个过滤器，生成一个或的过滤器。牛B。<br /><br /><br />http://challenge01.root-me.org/web-serveur/ch25/<br />合取查询，截断<br />admin*(password="+payload+"*))%00<br /></div></div>
</body></html>