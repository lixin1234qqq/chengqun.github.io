<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>第5.7节 上传漏洞</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="methodology.html">methodology</a></p>

<ol>
<li><a href="methodology--第一部分_信息收集.html">第一部分 信息收集</a></li>
<ol>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集.html">第1章 端口信息收集</a></li>
<ol>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.1节_21端口ftp.html">第1.1节 21端口ftp</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.2节_22端口ssh.html">第1.2节 22端口ssh</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.3节_25端口SMTP.html">第1.3节 25端口SMTP</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.4节_53端口DNS.html">第1.4节 53端口DNS</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.5节_79端口Finger.html">第1.5节 79端口Finger</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.6节_161端口snmp.html">第1.6节 161端口snmp</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.7节_137-139-445_smb.html">第1.7节 137/139/445 smb</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.8节_389端口ldap.html">第1.8节 389端口ldap</a></li>
<li><a href="methodology--第一部分_信息收集--第1章_端口信息收集--第1.9节_2049端口nfs.html">第1.9节 2049端口nfs</a></li>
</ol>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集.html">第2章 web信息收集</a></li>
<ol>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.1节_枚举web目录.html">第2.1节 枚举web目录</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.2节_http方法测试.html">第2.2节 http方法测试</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.3节_https方法测试.html">第2.3节 https方法测试</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.4节_web页面生成字典.html">第2.4节 web页面生成字典</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.5节_web页面图片泄露.html">第2.5节 web页面图片泄露</a></li>
<li><a href="methodology--第一部分_信息收集--第2章_web信息收集--第2.6节_Squid代理.html">第2.6节 Squid代理</a></li>
</ol>
</ol>
<li><a href="methodology--第二部分_漏洞利用.html">第二部分 漏洞利用</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第3章_未知exp的漏洞.html">第3章 未知exp的漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第3章_未知exp的漏洞--第3.1节_搜索exp.html">第3.1节 搜索exp</a></li>
<li><a href="methodology--第二部分_漏洞利用--第3章_未知exp的漏洞--第3.2节_下载exp.html">第3.2节 下载exp</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助.html">第4章 漏洞利用辅助</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.1节_文件字符串分析.html">第4.1节 文件字符串分析</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.2节_webshell.html">第4.2节 webshell</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.3节_反弹shell.html">第4.3节 反弹shell</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.4节_突破受限制的shell.html">第4.4节 突破受限制的shell</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.5节_传输文件.html">第4.5节 传输文件</a></li>
<li><a href="methodology--第二部分_漏洞利用--第4章_漏洞利用辅助--第4.6节_错误处理.html">第4.6节 错误处理</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞.html">第5章 通用漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.1节_登录凭证.html">第5.1节 登录凭证</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.2节_http_PUT方法.html">第5.2节 http PUT方法</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.3节_Shellshock.html">第5.3节 Shellshock</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.4节_任意文件读取LFI.html">第5.4节 任意文件读取LFI</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.5节_远程命令执行.html">第5.5节 远程命令执行</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.6节_sql注入漏洞.html">第5.6节 sql注入漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.6节_sql注入漏洞--mysql注入.html">mysql注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.6节_sql注入漏洞--mssql注入.html">mssql注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.6节_sql注入漏洞--oracle注入.html">oracle注入</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.7节_上传漏洞.html">第5.7节 上传漏洞</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.8节_Nosql注入.html">第5.8节 Nosql注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.9节_LDAP注入.html">第5.9节 LDAP注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.10节_服务端模板注入.html">第5.10节 服务端模板注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.11节_xxe漏洞.html">第5.11节 xxe漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.11节_xxe漏洞--案例1_excel的xxe.html">案例1: excel的xxe</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.11节_xxe漏洞--案例2_php的xxe执行命令.html">案例2 php的xxe执行命令</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.12节_xpath注入.html">第5.12节 xpath注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.13节_SSRF.html">第5.13节 SSRF</a></li>
<li><a href="methodology--第二部分_漏洞利用--第5章_通用漏洞--第5.14节_Padding_Oracle_Attack.html">第5.14节 Padding Oracle Attack</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞.html">第6章 已知漏洞</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.1节_nodejs.html">第6.1节 nodejs</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php.html">第6.2节 php</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php--弱类型.html">弱类型</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php--php一句话.html">php一句话</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php--php代码注入.html">php代码注入</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.2节_php--php代码审计.html">php代码审计</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.3节_java.html">第6.3节 java</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.3节_java--处理excel导致的xxe漏洞.html">处理excel导致的xxe漏洞</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.3节_java--java反序列化demo.html">java反序列化demo</a></li>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.3节_java--Apache_Shiro_rememberMe反序列化.html">Apache Shiro rememberMe反序列化</a></li>
</ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.4节_thinkphp.html">第6.4节 thinkphp</a></li>
<ol>
<li><a href="methodology--第二部分_漏洞利用--第6章_已知漏洞--第6.4节_thinkphp--thinkphp5.0.235.1.31.html">thinkphp<5.0.23<5.1.31</a></li>
</ol>
</ol>
</ol>
<li><a href="methodology--第三部分_权限提升.html">第三部分 权限提升</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权.html">第7章 linux提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.1节_寻找登录凭证.html">第7.1节 寻找登录凭证</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.2节_寻找可写文件.html">第7.2节 寻找可写文件</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.3节_内核提权.html">第7.3节 内核提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.3节_内核提权--案例1_dirtyc0w提权.html">案例1 dirtyc0w提权</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.3节_内核提权--案例2_ubuntu提权.html">案例2 ubuntu提权</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权.html">第7.4节 进程提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权--4.3.1_mysql.html">4.3.1 mysql</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权--4.3.2_nfs提权.html">4.3.2 nfs提权</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权--4.3.3_chkrootkit提权.html">4.3.3 chkrootkit提权</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.4节_进程提权--4.3.4_tar通配符提权.html">4.3.4 tar通配符提权</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.5节_定时任务.html">第7.5节 定时任务</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.6节_sudo提权.html">第7.6节 sudo提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.6节_sudo提权--4.5.1_nmap.html">4.5.1 nmap</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.7节_SUID文件.html">第7.7节 SUID文件</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.8节_root.html">第7.8节 root</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.8节_root--4.7.1_执行命令.html">4.7.1 执行命令</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.8节_root--4.7.2_编辑文件.html">4.7.2 编辑文件</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.9节_劫持全路径.html">第7.9节 劫持全路径</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.10_环境变量.html">第7.10 环境变量</a></li>
<li><a href="methodology--第三部分_权限提升--第7章_linux提权--第7.11节_破解shadow文件.html">第7.11节 破解shadow文件</a></li>
</ol>
<li><a href="methodology--第三部分_权限提升--第8章_windows提权.html">第8章 windows提权</a></li>
<ol>
<li><a href="methodology--第三部分_权限提升--第8章_windows提权--windows提权辅助.html">windows提权辅助</a></li>
</ol>
</ol>
<li><a href="methodology--第四部分_内网漫游.html">第四部分 内网漫游</a></li>
<ol>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot.html">第9章 Pivot</a></li>
<ol>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot--第9.1节_ssh端口转发.html">第9.1节 ssh端口转发</a></li>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot--第9.2节_iptables端口转发.html">第9.2节 iptables端口转发</a></li>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot--第9.3节_msf后渗透.html">第9.3节 msf后渗透</a></li>
<li><a href="methodology--第四部分_内网漫游--第9章_Pivot--第9.0节_未整理.html">第9.0节 未整理</a></li>
</ol>
<li><a href="methodology--第四部分_内网漫游--第10章_缓冲区溢出.html">第10章 缓冲区溢出</a></li>
<ol>
<li><a href="methodology--第四部分_内网漫游--第10章_缓冲区溢出--第10.1节_windows溢出.html">第10.1节 windows溢出</a></li>
<ol>
<li><a href="methodology--第四部分_内网漫游--第10章_缓冲区溢出--第10.1节_windows溢出--brainpan.html">brainpan</a></li>
<li><a href="methodology--第四部分_内网漫游--第10章_缓冲区溢出--第10.1节_windows溢出--smail案例.html">smail案例</a></li>
</ol>
</ol>
<li><a href="methodology--第四部分_内网漫游--metasploit.html">metasploit</a></li>
<li><a href="methodology--第四部分_内网漫游--backdoor.html">backdoor</a></li>
</ol>
<li><a href="methodology--第五部分_挖掘src.html">第五部分 挖掘src</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试.html">10. 业务逻辑测试</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论.html">10.1 业务逻辑理论</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.1_业务逻辑数据一致性.html">6.1.1 业务逻辑数据一致性</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.2_业务逻辑数据完整性.html">6.1.2 业务逻辑数据完整性</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.3_工作流程逃逸测试.html">6.1.3 工作流程逃逸测试</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.4_伪造请求能力测试.html">6.1.4 伪造请求能力测试</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--6.1.5_测试处理用时.html">6.1.5 测试处理用时</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.1_业务逻辑理论--10.1.6_客户端认证.html">10.1.6 客户端认证</a></li>
</ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法.html">10.2 攻击方法</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法--6.2.1.1_加密http请求参数.html">6.2.1.1 加密http请求参数</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法--6.2.1.2_修改返回包.html">6.2.1.2 修改返回包</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法--6.2.1.3_修改http参数.html">6.2.1.3 修改http参数</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.2_攻击方法--6.2.1.4_去除http请求参数.html">6.2.1.4 去除http请求参数</a></li>
</ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景.html">10.3 业务场景</a></li>
<ol>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.1_用户操作.html">10.3.1 用户操作</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.2_用户注册.html">10.3.2 用户注册</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.3_修改密码.html">10.3.3 修改密码</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.4_验证码安全.html">10.3.4 验证码安全</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.5_订单安全.html">10.3.5 订单安全</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.6_功能使用次数.html">10.3.6 功能使用次数</a></li>
<li><a href="methodology--第五部分_挖掘src--10._业务逻辑测试--10.3_业务场景--10.3.7_客户端验证密码.html">10.3.7 客户端验证密码</a></li>
</ol>
</ol>
<li><a href="methodology--第五部分_挖掘src--11._app安全.html">11. app安全</a></li>
</ol>
<li><a href="methodology--oob.html">oob</a></li>
<li><a href="methodology--DDOS.html">DDOS</a></li>
<ol>
<li><a href="methodology--DDOS--DDOS事件处理.html">DDOS事件处理</a></li>
</ol></ol></div>
<div class="page"><h1><b><u>第5.7节 上传漏洞</u></b></h1>https://github.com/c0ny1/upload-labs<br /># php-upload-labs<br />## 1. js验证<br />突破方法，将info.php改为info.jpg，当js检测过后。往服务端提交时，用burpsuite截断，然后修改为info.php。成功！<br /><br /><br />## 2.MIME检测<br />突破方法，上传info.php文件，修改Content-Type为image/jpeg.<br />![](_v_images/1541725232_4155.png)<br />## 3.后缀黑名单<br />### 1.黑名单检测<br />本pass禁止上传.asp|.aspx|.php|.jsp后缀文件<br />突破方式:上传.php3后缀。<br />![](_v_images/1541725520_18870.png)<br />### 2.黑名单检测,上传.htaccess<br />禁止上传.php|.php5|.php4|.php3|.php2|php1|.html|.htm|.phtml|.pHp|.pHp5|.pHp4|.pHp3|.pHp2|pHp1|.Html|.Htm|.pHtml|.jsp|.jspa|.jspx|.jsw|.jsv|.jspf|.jtml|.jSp|.jSpx|.jSpa|.jSw|.jSv|.jSpf|.jHtml|.asp|.aspx|.asa|.asax|.ascx|.ashx|.asmx|.cer|.aSp|.aSpx|.aSa|.aSax|.aScx|.aShx|.aSmx|.cEr|.sWf|.swf后缀文件！<br />突破方法:上传.htaccess<br />```<br />SetHandler application/x-httpd-php<br />```<br />此目录所有文件都会被解析成php.<br />![](_v_images/1541726241_32577.png)<br />### 3.黑名单检测，未大小写统一<br />禁止上传.php|.php5|.php4|.php3|.php2|php1|.html|.htm|.phtml|.pHp|.pHp5|.pHp4|.pHp3|.pHp2|pHp1|.Html|.Htm|.pHtml|.jsp|.jspa|.jspx|.jsw|.jsv|.jspf|.jtml|.jSp|.jSpx|.jSpa|.jSw|.jSv|.jSpf|.jHtml|.asp|.aspx|.asa|.asax|.ascx|.ashx|.asmx|.cer|.aSp|.aSpx|.aSa|.aSax|.aScx|.aShx|.aSmx|.cEr|.sWf|.swf|.htaccess后缀文件<br />突破方法: 大小写！！<br />![](_v_images/1541726466_12441.png)<br /><br /><br />### 4.黑名单检测，后缀未去空<br />突破方法:后缀留空格<br />这样检测.后面的后缀带一个空格就会不匹配黑名单。<br />![](_v_images/1541726615_32471.png)<br /><br /><br />### 5.黑名单检测，后缀未去.<br />对程序文件判断来说，后缀加.是新的文件。但是当iis进行解析时，windows的特性，会去掉后缀名中的.<br />绕过方法:后面加.<br />![](_v_images/1541726922_9400.png)<br /><br /><br />### 6.黑名单检测，后缀未去::$DATA<br />利用windows特性，后缀加::$DATA<br />测试失败！ windows 2012 <br />### 7.黑名单检测，但是文件名是处理后的文件名进行拼接<br />. .进行绕过(点+空格+点)，这样<br />![](_v_images/1541727635_6903.png)<br /><br /><br />### 8.黑名单检测，但是将后缀替换为空。<br />pphphp绕过<br /><br /><br />## 4.后缀白名单<br />### 1. 白名单路径拼接，更改路径变量%00截断，需要路径变量。<br />![](_v_images/1541728449_29576.png)<br />这样保存文件时， 路径+文件名。后面的info.jpg被截断了。<br />![](_v_images/1541728520_7957.png)<br />此时，访问info.php就OK了。<br />### 2. 路径可控，利用burpsuite%00<br />![](_v_images/1541728838_12188.png)<br />![](_v_images/1541728784_1824.png)<br /><br /><br /><br /><br />### 3.检测文件格式内容来进行白名单<br />jpg<br />png<br />gif<br />copy normal.jpg /b + shell.php /a webshell.jpg<br />根据文件格式的二进制内容来判断后缀。jpg,png,gif.三个白名单。当然，如果路径可控，依然可以通过，1，2然后配合这个绕过来利用，但是路径不可控的话，需要利用其它例如文件包含来进一步利用。<br /><br /><br />### 4. 通过getimagesize获取文件类型<br />getimagesize()来检测是否为图片。<br />同上，只能上传图片<br /><br /><br />### 5. 通过php_exif来检验是否为图片<br />同上，只能上传图片<br /><br /><br />### 6. imagecreatefromgif<br />同上，只能上传图片<br /><br /><br />## 5.条件竞争<br />先上传临时文件，move文件，rename文件，unlink删除文件。<br />因此，当在rename文件前访问文件，即可完成条件竞争。<br />![](_v_images/1541733739_29186.png)<br />无限上传，然后无限访问文件。<br />问题出在move_uploaded_file上，现在无限上传任意后缀都会执行，在unlink之前访问进行。条件竞争了。nice.<br />添加一个无用的cookie字段。<br /><br /><br />## 6.CVE-2015-2348<br />move_uploaded_file()<br />控制savename的变量值。<br />![](_v_images/1541731672_7246.png)<br />![](_v_images/1541731624_29245.png)<br />%00截断<br />## 7.找不到上传目录<br />subSysFolder<br />参考:<br />https://dayu.ink/pockr-unauthorized-access.html<br /># 上传zip格式<br />Create a symlink in your computer to /etc/passwd<br />e.g.: ln -s /etc/passwd ./symlink.jpg<br />Create a zip with the symlink<br />e.g.: zip —symlinks -r photos.zip ./symlink.jpg<br /><br /><br />实际案例:<br />http://challenge01.root-me.org/web-serveur/ch51/tmp/upload/5baee609054aa5.37319169/symlink.txt<br />exp:<br />ln -s ../../../index.php ./symlink.txt<br />zip --symlinks -r test.zip ./symlink.txt<br /><br /><br />参考链接:https://security.stackexchange.com/questions/73718/how-zip-symlink-works<br /><br /><br /><br /><br /># 文件名可控<br />上传前的文件名存在到上传后的文件中，可以通过%00截断<br />本身文件名为:my.php%00.jpg<br /><br /><br /># 真实漏洞<br />## wstmall上传漏洞<br />exp：<br />```html<br />&lt;html&gt;<br />&lt;body&gt;<br /><br /><br />&lt;form action="http://demo.wstmall.net/index.php/Home/AppUpload/commentUpload" method="post"<br />enctype="multipart/form-data"&gt;<br />&lt;input type="file" name="img" id="file" /&gt; <br />&lt;br /&gt;<br />&lt;input type="submit" name="submit" value="Submit" /&gt;<br />&lt;/form&gt;<br /><br /><br />&lt;/body&gt;<br />&lt;/html&gt;<br />```<br /><br /><br /><br /><br /># 解析漏洞<br />## IIS<br />1. iis6.0 文件解析 xx.asp;.jpg<br />2. iis6.0 目录解析 xx.asp/1.jpg<br />3. iis7.0 畸形解析 xx.jpg/x.asp<br />4. IIS 7.5 upload RCE<br />## apache<br />1. %0a(CVE-2017-15715)<br />2. 未知后缀 test.php.xxx<br />参考文章:https://c1h3ng.github.io/web/2018/04/10/apache-cve/<br /><br /><br />## nginx<br />1. 访问连接后面加/xxx.php 如:test.jpg/xxx.php<br />2. 畸形解析漏洞 test.jpg%00xxx.php<br />3. CVE-2013-4547 test.jpg(非编码空格)\0x.php<br /><br /><br />## tomcat<br />windows<br />1. xxx.jsp/<br />2. xxx.jsp%20<br />3. xxx.jsp::$DATA<br /><br /><br /># 总结<br />## fuzz<br />路径/文件名/后缀<br />http://gv7.me/articles/2018/make-upload-vul-fuzz-dic/<br /><br /><br /># 情景1 上传后原文件名未改变<br />本身文件名为:my.php%00.jpg<br /><br /><br /># 情景2 通过.号来判断文件后缀<br />上传webshell.png.php<br /><br /><br /># 情景4 白名单判断<br /># 路径可控1<br /><br /><br /><br /><br /># 路径可控2 子目录路径subSysFolder<br />https://dayu.ink/pockr-unauthorized-access.html<br /><br /><br /># 竞争<br /><br /><br /># 上传zip<br /><br /><br /><br /><br /></div></div>
</body></html>